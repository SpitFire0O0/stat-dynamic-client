# Техническое задание (ТЗ) STAT‑DYNAMIC — v0.1

## 1. Цель
Создать учебную платформу с декларативной компоновкой интерфейса, опираясь на существующие модели Prisma и текущий фронтенд. Интеграции с API — поэтапно; в MVP — фикстуры и открытая архитектура для подключения OpenAPI.

## 2. Роли и доступы
- Роли: ADMIN, TEACHER, STUDENT, PARENT, (UI‑роль) CURATOR.
- Один пользователь может иметь несколько ролей.
- Доступы (маршруты, разделы, виджеты) настраиваются в конфиге.
- Пороговые статусы (ДЗ/пропуски) задаются глобально (см. GlobalConfig).

## 3. База данных (Prisma — schema.prisma)
Ключевые сущности и связи:
- User (contacts, grades, groups, dialogs, meetings, homework, achievements, tokens).
- Group (curatorId, students[]).
- Discipline → Course (themes[], grades[], studentPriority[]; academicYear).
- Theme (courseId, dateBegin/dateEnd; grades[], homeworks[]).
- Grade (A/B/C; type HOMEWORK/TEST/EXAM; studentId, teacherId?, courseId, themeId).
- Meeting (LESSON/EXAM/EVENT; curatorId; MeetingUsers: attendance flag; feedbacks[]).
- Homework (themeId, curatorId; students[]; studentHomeworks[]; files[]).
- StudentHomework (homeworkId; grades[]; files[]).
- Feedback (title/content/grade A/B/C; userId; meetings[]).
- Achievement (title/content/grade?; userId; files[]).
- Dialog/Message (attachments via File).

Примечание: в enum Permissions нет CURATOR — в UI используется как отдельная роль; решение о добавлении в БД — отдельно.

## 4. Функциональные модули (MVP)
- Главная: дашборд (статистика, ближайшие уроки, оценки, ДЗ, уведомления, быстрые действия).
- Профиль: карточка пользователя, контакты, достижения, статистика, настройки профиля.
- Домашние задания: список по темам/курсам, статусы выполнения.
- Расписание: просмотр (день/неделя), фильтры по группе/учителю/дню; отметка «Н» и ввод ДЗ (UI готов, интеграция позже).
- Сообщения: список контактов, чат 1:1 (групповые — позже).
- Библиотека: каталог материалов (список/поиск; расширение позже).
- Админка: пользователи, группы, дисциплины, курсы (CRUD — позже через API).
- Кружки: матрица активности + заметки учителя (плюсы/минусы) + ежемесячные достижения/трудности ученика.

## 5. Уведомления
- Триггеры: невыполненные ДЗ, пропуски (порог из GlobalConfig).
- Каналы: Telegram + in‑app в MVP; email/push — позже (отдельная интеграция).

## 6. Интерфейс и декларативность
- Страницы собираются из схем (PageScaffold + WidgetRegistry).
- Навигация/иконки/роли — в конфигах.
- Базовые поля форм — тонкие обёртки над Chakra без логики.

## 7. API слой
- Источник типов: OpenAPI (предпочтительно) и/или текущий swagger‑клиент (временно).
- Клиент: `openapi-fetch` с middleware (без таймаутов), добавляющий заголовки/токен.
- Расположение: `src/_api`.
- Схема: временно импорт из `src/temp/api/schema.ts`, позже заменить на нашу.
- Алиасы: реэкспорт DTO из `src/api/Api.ts` (временная мера) и `components/paths` из схемы, чтобы минимизировать самописные типы.

## 8. Маршруты
- `/`, `/profile`, `/profile/homework`, `/messages`, `/schedule`, `/docs`, `/settings`, `/admin`, `/clubs`, `/auth`.

## 9. Нефункциональные требования
- Не ломать текущую верстку; минимальные изменения.
- Типобезопасность: кода с самописными типами — по минимуму; использовать алиасы от схем/конфигов.
- Подготовка к подмене фикстур на API без изменения UI.

## 10. Dev‑утилиты
- Переключатель ролей (DEV): простой Select меняет `user.permissions` в store.

## 11. Критерии приёмки (MVP)
- Сборка страниц декларативно работает.
- Кружки отображают данные из фикстур.
- Навигация, роли и пороги управляются конфигами.
- API‑слой готов к подключению реальной схемы (openapi‑fetch функционирует).
