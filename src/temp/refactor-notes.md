# Декларативный каркас: обзор и реализация

## 1) Абстрактно — о сути рефакторинга
- Цель: отделить «что показывать» от «как выглядит», чтобы быстро менять содержание страниц, роли и меню без переписывания компонентов и без API-интеграций.
- Принцип: конфиг‑первый подход. Страницы, виджеты, навигация, роли и источники данных описываются в конфигурации/фикстурах; существующие UI‑компоненты не меняются.
- Ограничения: не трогаем стили и верстку, календарь — как есть, роутер — пока ручной. Формы — только инкапсуляция базовых полей без валидации/логики.
- Результат: появляется легкий «PageScaffold» и «WidgetRegistry», которые собирают страницы из схем; меню/иконки/роли переезжают в конфиги; мок‑данные вынесены в фикстуры.

Зачем так:
- Можно быстро включать/выключать секции, табы, страницы, виджеты.
- Проще наращивать функционал по мере готовности бэка/Призмы (подмена источника данных).
- Гарантированно не ломаем текущий UI: компоненты переиспользуются как «виджеты».

## 2) Чуть глубже — как именно сделано сейчас

### Новые конфиги и реестр
- `src/config/icons.ts`: строковые ключи → маппер на иконки (lucide-react).
- `src/config/roles.ts`: декларативные роли `Record<UserRole, RoleConfig>` с доступами и порогами статусов (жёлтый/красный). Примечание: роль `CURATOR` добавлена только в UI‑конфиг (в Prisma сейчас её нет в enum Permissions).
- `src/config/navigation.ts`: декларативное меню/сабменю с иконками‑ключами и возможностью указывать роли.

### Сборка страниц
- `src/components/page-scaffold/index.tsx` (PageScaffold): принимает `PageSchema` и отрисовывает секции.
- `src/lib/WidgetRegistry.tsx` (WidgetRegistry): маппинг `widgetId → компонент`. Для ваших Home‑блоков — lazy‑обёртки, чтобы не менять исходники. Для clubs — простые плейсхолдеры (данные выводятся как JSON).

### Фикстуры/схемы страниц
- `src/fixtures/users.ts`: базовые пользователи (ADMIN/TEACHER/STUDENT).
- `src/fixtures/clubs.ts`: данные для страницы «Кружки» (матрица активности, заметки учителя по месяцам, достижения ученика по месяцам).
- `src/config/pages/clubs.ts`: декларативная схема страницы `/clubs` — три секции (таблица активности, заметки учителя, достижения/трудности).

### Базовые поля формы (инкапсуляция без логики)
- `src/components/base/{Input,Select,Textarea}.tsx` + `index.ts`: тонкие обёртки над Chakra UI для дальнейшей интеграции валидации/масок.

### Маршрут «Кружки»
- `src/pages/clubs/index.tsx`: страница на PageScaffold.
- `src/app/router.tsx`: добавлен маршрут `/clubs` (остальной роутинг оставлен как есть).

### Что сознательно не трогали
- Sidebar всё ещё берёт меню из `src/constants.tsx` — перенос на `src/config/navigation.ts` запланирован отдельно, чтобы не затронуть текущий внешний вид.
- Страница расписания/календарь — без изменений.
- Валидация форм/сабмиты — отсутствуют (только базовые поля).

## 3) Как это подружить с Prisma (ориентиры)
- Фикстуры названы и структурированы так, чтобы было понятно, как их сопоставить с моделями из `src/temp/prisma/schema.prisma` (Users/Groups/Courses/Themes/Homework/Grades и пр.).
- Когда появится полноценное API, «источник данных» у секций можно будет менять со `data: { ...fixtures }` на загрузку из React Query/axios, не меняя схему страницы и виджетов.

## 4) Как откатить изменения (быстро и безопасно)
Если идея ок, но реализацию хотите поменять, безопасный откат — просто удалить добавленные файлы и правку роутера:
- Удалить каталоги/файлы:
  - `src/config/icons.ts`
  - `src/config/roles.ts`
  - `src/config/navigation.ts`
  - `src/components/page-scaffold/`
  - `src/lib/WidgetRegistry.tsx`
  - `src/fixtures/users.ts`
  - `src/fixtures/clubs.ts`
  - `src/config/pages/clubs.ts`
  - `src/components/base/` (если не планируете оставлять обёртки)
  - `src/pages/clubs/`
- Вернуть `src/app/router.tsx` в исходное состояние: удалить блок маршрута `/clubs` и импорт `ClubsPage`.
- Ничего в существующих страницах/компонентах не модифицировалось (кроме router), так что остальной UI останется без изменений.

## 5) Как переиспользовать идею (если будете переписывать реализацию)
- Минимальная сущность: `WidgetRegistry` + `PageScaffold` + `PageSchema`.
- Навигация/иконки/роли можно держать в одном файле или разнести; главное — строковые ключи и централизованный маппер для иконок.
- Для интеграции с Prisma/API подумайте о «источниках данных» в секции: `data?: object | () => Promise<T> | QuerySpec`. Тогда подмена источника займёт одну строку в схеме.
- Роль‑гварды можно ввести на уровне:
  - маршрута (не пуская в RouterProvider);
  - секции (не рендерить секцию);
  - виджета (внутри PageScaffold).
- Для календаря/расписания удобно завести конфиг «слоты/типы/статусы», но реализацию оставлять неизменной — только адаптер данных.

## 6) Важные примечания/решения
- `CURATOR` есть в UI‑ролях, но его нет в Prisma enum Permissions — это осознанно, для декларативного отображения (можно удалить/заменить, если решите строго следовать Prisma).
- Роутер пока ручной: `/clubs` добавлен явно, авто‑генерацию роутов по конфигу сознательно не включал.
- Визуал «Кружков» — плейсхолдеры, чтобы не трогать стили; когда появится готовый виджет/дизайн, достаточно сменить маппинг в `WidgetRegistry`.

---
Если потребуется — допишу гайды: «перевод Sidebar на navigation.ts», «источники данных секций», «роль‑гварды в PageScaffold».
